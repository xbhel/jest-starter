# JavaScript 单元测试

> 翻译自 https://www.browserstack.com/guide/unit-testing-in-javascript

在测试领域，测试单个功能与端到端（end-to-end）的测试整个应用完全不同，虽然这两者同样重要。测试每个功能（也称为单元）对于确保应用程序中的每个功能都按预期执行是必要的，这也是单元测试的用武之地。

由于 JavaScript 是一种用于开发 Web 应用程序的流行编程语言，因此有必要了解如何在 JavaScript 中执行单元测试。本文将探讨如何执行这些测试、在哪里执行以及为什么。

## 什么是单元测试

单元测试用于验证系统中软件单元的行为，它用于验证代码库中的一小部分独立的代码（也称为单元）的行为是否符合开发人员的预期。

单元测试验证的是一个应用中最小的部分或者组件，通过将在完全隔离下的预期行为和实际行为相比较。这里 “完全隔离” 意味着，在单元测试期间，开发人员不会将应用与外部依赖连接起来，例如数据库、文件系统、HTTP 服务，这样能够让单元测试更快更稳定，因为它们不会由于与这些外部服务集成的问题而导致失败。

## 为什么编写单元测试

通常，开发人员先编写单元测试，然后再编写软件代码，这种方式就是著名的 TDD（test-driven development），在 TDD 中，需求将被转换为特定的测试案例，然后完善软件让它通过这些测试案例。<u>在单元测试的情况下，它允许在不影响其他单元或整个软件的功能的情况下修改代码</u>，这使开发人员的工作更容易，因为在这个阶段很容易找到错误，从而节省时间和金钱。

> 单元测试的要求你修改的代码必须能够通过之前所有的单元测试，如果不能通过，而且你不能立即修复，那么应该回滚它（因为在你修改之前功能是好的，那么说明你这次的修改不正确），以便于确保它不会影响到其他单元或整个软件的功能。

此外，在单元测试环境中，产品的各个模块彼此隔离，并有自己的职责范围，在这种情况下，测试是更加可靠，因为它们是在封闭的环境中运行。同样由于测试更可靠，这也能让代码更加可靠。

除了上面所说的这些方面，单元测试还有以下好处：

- 单元测试有助于更快更简单的发现和修复 bug。
- 单元测试有助于提高代码质量。
- 单元测试有助于更好的应用程序架构。
- 单元测试充当文档。

单元测试最大的优势在于它专注于测试单个功能，因此能够给予非常精准的反馈，如果单元测试失败，那么在绝大多数情况下，测试人员可以确定被测试的这个功能就是问题所在。

单元测试另一个优势就是速度，由于它们速度快，因此执行频率更高，从而使它们成为几乎持续不断的有价值反馈的来源。

## 创建单元测试的最佳实践

创建单元测试时应遵循以下最佳实践：

- 单元测试应该具备快、简单的特点。因为开发人员需要以更高的速度运行单元测试用例，如果单元测试很慢，那么开发人员将不会经常运行测试用例，也就失去了单元测试的意义，此外，单元测试用例越简单，测试结果就越准确。
- 测试用例不应重复实现逻辑。
- 测试用例应该具有确定性，只要代码不改变，不管执行多少次它们都应该具有一样的行为/结果。
- 测试用例应该具有一个强有力的命名约定。

## JavaScript 单元测试

**JavaScript 单元测试**是一种为网页或 Web 应用程序模块编写 JavaScript 测试代码的方法，它与 HTML 结合作为内联事件处理程序并在浏览器中执行以测试所有功能是否按预期工作，然后将这些单元测试组织在测试套件中。

有多种框架有助于 JavaScript 中的单元测试。它们如下：

- Unit.js：JavaScript 的断言库，在 Node.js 和浏览器上运行。它适用于任何类型的测试运行器（test runner）和单元测试框架，如 Mocha、Jasmine、Karma、量角器（Angular 应用程序的 E2E 测试框架）、QUnit 等。
- Mocha：在 Node.js 和浏览器中运行的测试框架，该框架通过串行运行测试使异步测试变得简单。 Mocha 测试连续运行，允许灵活准确的报告，同时将未捕获的异常映射到正确的测试用例。
- Jest：它是一个基于 JavaScript 的开源测试框架，主要设计用于与 React 和基于 React Native 的 Web 应用程序一起使用。通常，单元测试在任何软件的前端运行时都不是很有用。这主要是因为前端的单元测试需要大量、耗时的配置，使用 Jest 框架可以在很大程度上降低这种复杂性。
- Jasmine：Jasmine 是一个流行的 JavaScript 行为驱动开发框架，用于对 JavaScript 应用程序进行单元测试。它提供了用于为同步和异步代码运行自动化测试的实用程序。
- [Karma](https://karma-runner.github.io/latest/index.html)：Karma 是一个基于 Node 的测试工具，允许您跨多个真实浏览器测试您的 JavaScript 代码。它使测试驱动的开发变得快速、有趣和简单，在技术上被称为测试运行器。
- Cypress: Cypress 框架是一个基于 JavaScript 的端到端测试框架，构建在 Mocha 之上，Cypress 使异步测试变得简单方便， Cypress 中的单元测试甚至无需运行 Web 服务器即可执行。这使得 Cypress 成为测试旨在用于浏览器的 JS/TS 库的理想工具。

## 编写一个单元测试

